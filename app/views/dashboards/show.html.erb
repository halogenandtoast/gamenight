<div class="sections">
  <div class="left-column">
    <section class="column-section column">
      <header class='title'>
        <h1>My Groups</h1>
        <%= link_to "+", new_group_path, class: 'add-link', data: { role: 'add-group' } %>
      </header>

      <div id="groups">
        <% current_user.groups.each do |group| %>
          <%= div_for(group) do %>
            <%= link_to group.title, group, class: 'group-link' %>
            <%= link_to "Leave group", [:leave, group], method: :delete, confirm: "Are you sure you want to leave #{group.title}", class: 'group-leave-link' %>
          <% end %>
        <% end %>
      </div>
    </section>
  </div>

  <section class="column-section">
    <header class='title'>
      <h1>My Games</h1>
      <%= link_to "+", new_game_path, class: 'add-link', data: { role: 'add-game' } %>
    </header>

    <div class="games">
      <% if @boxes.any? %>
        <% @boxes.each do |box| %>
          <%= div_for(box) do %>
            <%= image_tag(box.image, width: 200) %>

            <%= form_for box, url: assign_box_path(box), namespace: box.title.parameterize, remote: true, method: :patch do |form| %>
              <%= form.label :location_id, "at" %>
              <%= form.select :location_id, current_user.locations.map { |location| [location.title, location.id] }, { include_blank: true }, { class: 'box-location-field' } %>
            <% end %>

            <%= link_to "Remove", box, method: :delete, class: "remove", data: { confirm: "Are you sure?" } %>
          <% end %>
        <% end %>
      <% else %>
        No games yet.
      <% end %>
    </div>
  </section>
</div>

<script type="text/javascript">
  $(".box-location-field").on("change", function() {
    $(this.form).trigger("submit")
  });
</script>
